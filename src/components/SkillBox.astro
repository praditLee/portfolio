---
const { skill } = Astro.props;
const lightboxId = skill.title.toLowerCase().replace(/\s+/g, "-");
---

<a href={`#${lightboxId}`} class="skill-box glightbox">
  <div class="box-content-visible">
    <div class="tool-icons">
      {
        skill.tools.map((tool) => (
          <div
            class="icon-wrapper"
            title={tool.name}
            style={tool.hexColor ? `--brand-color: ${tool.hexColor}` : ""}
          >
            {/* --- นี่คือ Logic การเลือกแสดงผล --- */}
            {tool.type === "svg" ? (
              <svg viewBox="0 0 24 24" class="icon-svg">
                <path d={tool.icon} fill="currentColor" />
              </svg>
            ) : (
              <img src={tool.icon} alt={`${tool.name} icon`} class="icon-img" />
            )}
          </div>
        ))
      }
    </div>
    <h3 class="box-title">{skill.title}</h3>
    <p class="box-description">{skill.shortDescription}</p>
  </div>
</a>

{/* --- ทำเช่นเดียวกันในส่วนของ Lightbox --- */}
<div id={lightboxId} class="skill-lightbox-content" style="display:none;">
  <div class="lightbox-inner-content">
    <h2 class="box-title">{skill.title}</h2>
    <p class="box-description" set:html={skill.longDescription} />
    <div class="tool-icons">
      {
        skill.tools.map((tool) => (
          <div
            class="icon-wrapper"
            title={tool.name}
            style={tool.hexColor ? `--brand-color: ${tool.hexColor}` : ""}
          >
            {tool.type === "svg" ? (
              <svg viewBox="0 0 24 24" class="icon-svg">
                <path d={tool.icon} fill="currentColor" />
              </svg>
            ) : (
              <img src={tool.icon} alt={`${tool.name} icon`} class="icon-img" />
            )}
          </div>
        ))
      }
    </div>
  </div>
</div>
<style>
  .skill-box {
    display: block;
    background-color: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--border-radius);
    padding: var(--spacing-md);
    text-decoration: none;
    color: var(--color-text-primary);
    height: 100%;
    transition:
      transform 0.2s ease,
      box-shadow 0.2s ease;
  }
  .skill-box:hover {
    transform: translateY(-5px);
    box-shadow: var(--box-shadow);
  }
  .box-title {
    margin-top: var(--spacing-sm);
  }
  .box-description {
    color: var(--color-text-secondary);
    font-size: 0.9rem;
  }

  .tool-icons {
    display: flex;
    gap: var(--spacing-sm);
    /* สีเริ่มต้นของ SVG จะถูกควบคุมโดย .icon-svg ด้านล่าง */
  }
  .icon-wrapper {
    width: 24px;
    height: 24px;
    transition: transform 0.2s ease-in-out; /* เอา color transition ออกจากที่นี่ */
  }

  .skill-box:hover .icon-wrapper {
    transform: scale(1.1);
  }

  .icon-svg {
    width: 100%;
    height: 100%;
    color: var(--color-text-secondary); /* << สีเริ่มต้นของ SVG */
    transition: color 0.2s ease-in-out;
  }
  .skill-box:hover .icon-svg {
    color: var(--brand-color, var(--color-text-secondary)); /* << สีตอน hover */
  }

  .icon-img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    filter: grayscale(100%);
    opacity: 0.8;
    transition: all 0.3s ease-in-out;
  }
  .skill-box:hover .icon-img {
    filter: grayscale(0%);
    opacity: 1;
  }

  /* --- สไตล์ของ Lightbox --- */
  .skill-lightbox-content {
    padding: var(--spacing-lg);
    max-width: 600px;
    margin: 0 auto;
    background-color: var(--color-background);
    border-radius: var(--border-radius);
  }
  /* ... สไตล์ Lightbox อื่นๆ ... */
  .lightbox-inner-content .icon-wrapper {
    width: 32px;
    height: 32px;
  }
  .lightbox-inner-content .icon-wrapper:hover {
    color: var(--brand-color);
    transform: scale(1.1);
  }

  .lightbox-inner-content .tool-icons {
    margin-top: var(--spacing-lg);
    padding-top: var(--spacing-lg);
    border-top: 1px solid var(--color-border);
    justify-content: center;
  }
  .lightbox-inner-content .icon-wrapper {
    width: 32px;
    height: 32px;
  }
  .lightbox-inner-content .box-title {
    text-align: center;
    margin-bottom: var(--spacing-sm);
  }

  /* --- ส่วนที่แก้ไขสำหรับ SVG ใน Lightbox --- */
  .lightbox-inner-content .icon-svg {
    color: var(--color-text-secondary);
    transition: color 0.2s ease-in-out;
  }
  .lightbox-inner-content .icon-wrapper:hover .icon-svg {
    color: var(--brand-color);
  }

  /* สไตล์สำหรับ IMG ใน Lightbox (เหมือนเดิม) */
  .lightbox-inner-content .icon-img {
    filter: grayscale(100%);
    opacity: 0.8;
    transition: all 0.3s ease-in-out;
  }
  .lightbox-inner-content .icon-wrapper:hover .icon-img {
    filter: grayscale(0%);
    opacity: 1;
  }
</style>
